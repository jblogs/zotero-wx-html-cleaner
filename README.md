# Zotero微信HTML清理插件

这是一个为Zotero 7设计的插件，用于清理通过SingleFile保存的微信公众号文章HTML文件，使其更适合在Zotero中阅读和管理。

## 功能特点

- 🧹 **智能清理**: 移除多余的CSS样式、字体设置和装饰性元素
- 📝 **内容保留**: 保留文章标题、作者、正文内容和图片
- 🔄 **去重优化**: 自动去除重复内容，优化段落格式
- 📱 **微信适配**: 专门针对微信公众号文章的HTML结构优化
- 🏷️ **自动标记**: 为清理后的文件添加标签便于识别
- 📊 **进度提示**: 批量处理时显示详细的进度和结果

## 安装方法

### 方法一：从XPI文件安装（推荐）

1. 下载 `wx-html-cleaner.xpi` 文件
2. 打开Zotero 7
3. 进入 `工具` → `插件`
4. 点击齿轮图标 → `从文件安装插件`
5. 选择下载的XPI文件
6. 重启Zotero

### 方法二：开发模式安装

1. 克隆或下载此项目到本地
2. 打开Zotero 7
3. 进入 `工具` → `插件`
4. 点击齿轮图标 → `从文件安装插件`
5. 选择项目根目录下的 `install.rdf` 文件
6. 重启Zotero

## 使用方法

### 清理HTML附件

1. 在Zotero中选择包含HTML附件的条目
2. 右键点击条目或附件
3. 选择 `清理微信HTML`
4. 插件会自动处理所有HTML附件并生成清理后的版本
5. 清理后的文件会自动添加到相同的父条目下

### 批量处理

- 可以同时选择多个包含HTML附件的条目
- 插件会显示处理进度和结果摘要
- 支持处理失败时的详细错误信息

## 清理效果

### 清理前
- 文件大小: ~1.5MB
- 包含大量CSS样式和重复内容
- 格式混乱，不适合阅读

### 清理后
- 文件大小: ~400KB (减少约73%)
- 内容结构清晰
- 正文格式正确
- 图片正常显示
- 适合在Zotero中阅读和注释

## 技术特性

### 清理功能
- 移除 `<style>` 标签和内联样式
- 清理 `class` 和 `id` 属性
- 移除JavaScript代码
- 过滤导航和UI元素
- 去除重复内容

### 内容保留
- 文章标题和元信息
- 作者和发布时间
- 正文段落内容
- 图片（包括base64编码）
- 基本的HTML结构

### 智能处理
- 主要内容区域识别
- 段落智能分割
- 图片属性优化
- 文本去重算法

## 文件结构

```
zotero-wx-html-cleaner/
├── install.rdf                 # 插件元数据
├── chrome.manifest            # 资源配置
├── bootstrap.js               # 插件启动脚本
├── content/
│   ├── overlay.xul           # UI覆盖定义
│   ├── overlay.js            # 主要功能实现
│   └── htmlCleaner.js        # HTML清理核心逻辑
├── locale/
│   ├── en-US/
│   │   └── overlay.dtd       # 英文界面文本
│   └── zh-CN/
│       └── overlay.dtd       # 中文界面文本
└── README.md                 # 说明文档
```

## 兼容性

- **Zotero版本**: 7.0及以上
- **操作系统**: Windows, macOS, Linux
- **文件格式**: HTML文件（特别是SingleFile保存的微信文章）

## 开发说明

### 构建XPI文件

```bash
# 进入插件目录
cd zotero-wx-html-cleaner

# 创建XPI文件（实际上是ZIP格式）
zip -r wx-html-cleaner.xpi * -x "*.git*" "README.md" "build.sh"
```

### 调试模式

1. 在Zotero中启用调试模式：`帮助` → `调试输出记录`
2. 查看控制台输出：`工具` → `开发者` → `错误控制台`
3. 插件日志以 `WxHtmlCleaner:` 开头

## 常见问题

### Q: 插件安装后没有出现菜单选项？
A: 请确保重启了Zotero，并检查是否选择了包含HTML附件的条目。

### Q: 清理后的文件在哪里？
A: 清理后的文件会自动添加到原HTML文件的相同父条目下，文件名包含 `_cleaned` 后缀。

### Q: 支持哪些HTML文件？
A: 主要针对SingleFile保存的微信公众号文章，但也可以处理其他HTML文件。

### Q: 清理过程中出现错误怎么办？
A: 插件会显示详细的错误信息，请检查HTML文件是否完整，或查看Zotero的错误控制台。

## 更新日志

### v1.0.0
- 初始版本发布
- 支持微信HTML文章清理
- 实现右键菜单集成
- 添加进度提示和错误处理

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个插件。

## 联系方式

如有问题或建议，请通过GitHub Issues联系。